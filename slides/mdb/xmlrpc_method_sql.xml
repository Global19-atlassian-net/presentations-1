<slide title='method.sql'>
<example title='Using method.sql from the XML-RPC API' result='1'
fontsize='1.0em' rfontsize='1.5em' outputbackground='#ffffdd'>
<![CDATA[
<?php
require_once "XML/RPC.php";
$host = 'metallo.scripps.edu';
$port = 80;
$xmlrpc_uri = '/services/xmlrpc.php';

function &rpc_call(&$client, &$msg) {
	$r=$client->send($msg);
	if (!$r) {
		print "<PRE>ERROR: couldn't send message</PRE>\n";
		return 0;
	} else {
		if (!$r->faultCode()) {
			return $r->value();
		} else {
			print "Fault: ";
			print "Code: " . $r->faultCode() . 
				" Reason '" .$r->faultString()."'<BR>";
			return 0;
		}
	}
}

function toTable($arr) {
	$fields = array_keys($arr[0]);
	$nfields = count($fields);
	$out = "<table border=1>\n<tr align='center'>\n";
	for ($i=0; $i<$nfields; $i++) {
		$out .= "<th>".$fields[$i]."</th>\n";
	}
	$out .= "</tr>\n";
	$ndata = count($arr);
	for ($i=0; $i<$ndata; $i++) {
		$out .= "<tr align='center'>\n";
		while(list($f,$val) = each($arr[$i])) {
			$out .= "<td>&nbsp;".htmlspecialchars($val)."</td>\n";
		}
		$out .= "</tr>\n";
	}
	$out .= "</table>\n";
	return $out;
}


?>
<b>method.sql:</b> 
<small>"select source_id,expdata,rev_date,resolution,description 
from protein limit 10"</small><br>
<?php
$c=new XML_RPC_Client($xmlrpc_uri, $host, $port);
$method = "method.sql";
$query = "select source_id,expdata,rev_date,resolution,description from protein limit 10";

$q = new XML_RPC_Value($query, $GLOBALS['XML_RPC_String']);
$msg = new XML_RPC_Message($method,array($q));
$r = $c->send($msg);
$v = $r->value();
if (!$r->faultCode()) {
	echo toTable(XML_RPC_decode($v));
} else {
	echo "<pre>\n";
	echo "ERROR: ".$r->faultCode()." -- ".$r->faultString();
	echo "</pre>\n";
}

?>
]]>
</example>
</slide>
