<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>PHP in 2018</title>

		<meta name="description" content="PHP in 2018">
		<meta name="author" content="Rasmus Lerdorf">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="/reveal.js/css/reveal.css">
		<link rel="stylesheet" href="/reveal.js/css/theme/white.css" id="theme">

		<!-- For syntax highlighting - note that these are not the generic highlight.js theme files - see https://github.com/nwinkler/reveal-highlight-themes -->
		<link rel="stylesheet" href="/styles/xcode.css">

		<!-- Override a few styles -->
        <style>
        /*
		   Not actually sure why this block isn't being picked up from the syntax highlight css 
		   If you change the syntax highlight theme, copy the first block here
		*/
        .reveal pre {
                width: 100%;
        }

        .reveal pre code {
                display: block;
                max-height: 600px;
                overflow-x: auto;
                padding: 0.5em;
                line-height: 125%;
                background: #fff;
                color: black;
                -webkit-text-size-adjust: none;
        }

        .reveal section img {
               box-shadow: none;
               border: none;
        }

        .reveal code.shell {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            background: #000;
            color: #ddd;
            line-height: 125%;
            -webkit-text-size-adjust: none;
        }

        .reveal code.result {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            background: #ddd;
            color: #000;
            line-height: 125%;
            -webkit-text-size-adjust: none;
        }

        /* Left-align h3 and h4 if they are p elements */
        h3.p {
                text-align: left;
        }
        h4.p {
                text-align: left;
        }
        /* and left-aligned but slightly indented bullet lists */
        .reveal ul {
            display: block;
            margin: 0 0 1em 3em;
        }
		/* Example titles */
		p.example {
			text-align: left;
			margin: 0 0 -0.5em 1em;
			font-weight: bold;
		}
		/* Example output style */
		pre.output {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            background: #ddd;
            color: black;
			line-height: 200%;
            -webkit-text-size-adjust: none;
		}

        </style>

		 <!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '/reveal.js/css/print/pdf.css' : '/reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

        <!-- Needed for charts to work. Fall back to network if no local copy -->
        <script type='text/javascript' src='/jquery.min.js'></script> 
        <script>window.jQuery || document.write('<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">\x3C/script>')</script>
        <script src="/highcharts.js"></script>
        <script>window.Highcharts || document.write('<script src="http://code.highcharts.com/highcharts.js">\x3C/script>')</script>

		<!--[if lt IE 9]>
		<script src="/reveal.js/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>PHP in 2018</h1>
					<h3>Code as Craft</h3>
					<h3>Etsy, Brooklyn</h3>
					<h3>Nov.13, 2018</h3>
					<a href="http://talks.php.net/etsy18">http://talks.php.net/etsy18</a><br><br>
					<p>Rasmus Lerdorf<br>
					<small><a href="http://twitter.com/@rasmus">@rasmus</a></small>
					</p>
					<aside class="notes">
											</aside>
				</section>
					<section>
		<section id="hist_80s">
		<h1 style="text-align:center;text-transform:none">1980s</h1>
		<img src="/presentations/slides/intro/timex.jpg" align="center" width="" height="">
		</section>
<section id="hist_80s_1">
		<img src="/presentations/slides/intro/vic20.jpg" align="center" width="" height="">
		</section>
<section id="hist_80s_2">
		<img src="/presentations/slides/intro/hayes.jpg" align="center" width="" height="">
		</section>
<section id="hist_80s_3">
		<img src="/presentations/slides/intro/Zmodem.gif" align="center" width="" height="">
		</section>	</section>
	<section>
		<section id="hist_90s">
		<h1 style="text-align:center;text-transform:none">1990s</h1>
		<img src="/presentations/slides/intro/gopher.gif" align="center" width="" height="">
		</section>
<section id="hist_90s_1">
		<img src="/presentations/slides/intro/mosaic.jpg" align="center" width="" height="">
		</section>	</section>
	<section>
		<section id="hist_1993">
		<h3 class="p" style="text-align:center;">1993</h3>
		<pre><code class="C" data-trim style="font-size:0.8em;" >#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;ctype.h&gt;
#include &lt;string.h&gt;

#define ishex(x) (((x) &gt;= '0' &amp;&amp; (x) &lt;= '9') || ((x) &gt;= 'a' &amp;&amp; \
                   (x) &lt;= 'f') || ((x) &gt;= 'A' &amp;&amp; (x) &lt;= 'F'))

int htoi(char *s) {
	int     value;
	char    c;

	c = s[0];
	if(isupper(c)) c = tolower(c);
	value=(c &gt;= '0' &amp;&amp; c &lt;= '9' ? c - '0' : c - 'a' + 10) * 16;

	c = s[1];
	if(isupper(c)) c = tolower(c);
	value += c &gt;= '0' &amp;&amp; c &lt;= '9' ? c - '0' : c - 'a' + 10;

	return(value);
}

void main(int argc, char *argv[]) {
	char *params, *data, *dest, *s, *tmp;
	char *name, *age;

	puts(&quot;Content-type: text/html\r\n&quot;);
	puts(&quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Form Example&lt;/TITLE&gt;&lt;/HEAD&gt;&quot;);
	puts(&quot;&lt;BODY&gt;&lt;H1&gt;My Example Form&lt;/H1&gt;&quot;);
	puts(&quot;&lt;FORM action=\&quot;form.cgi\&quot; method=\&quot;GET\&quot;&gt;&quot;);
	puts(&quot;Name: &lt;INPUT type=\&quot;text\&quot; name=\&quot;name\&quot;&gt;&quot;);
	puts(&quot;Age: &lt;INPUT type=\&quot;text\&quot; name=\&quot;age\&quot;&gt;&quot;);
	puts(&quot;&lt;BR&gt;&lt;INPUT type=\&quot;submit\&quot;&gt;&quot;);
	puts(&quot;&lt;/FORM&gt;&quot;);

	data = getenv(&quot;QUERY_STRING&quot;);
	if(data &amp;&amp; *data) {
		params = data; dest = data;
    	while(*data) {
			if(*data=='+') *dest=' ';
			else if(*data == '%' &amp;&amp; ishex(*(data+1))&amp;&amp;ishex(*(data+2))) {
				*dest = (char) htoi(data + 1);
				data+=2;
			} else *dest = *data;
			data++;
			dest++;
		}
		*dest = '\0';
		s = strtok(params,&quot;&amp;&quot;);
		do {
			tmp = strchr(s,'=');
			if(tmp) {
				*tmp = '\0';
				if(!strcmp(s,&quot;name&quot;)) name = tmp+1;
				else if(!strcmp(s,&quot;age&quot;)) age = tmp+1;
			}
		} while(s=strtok(NULL,&quot;&amp;&quot;));

		printf(&quot;Hi %s, you are %s years old\n&quot;,name,age);
	}
	puts(&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;);
}</code></pre>
		</section>	</section>
	<section>
		<section id="hist_1993_2">
		<h3 class="p" style="text-align:center;">1993</h3>
		<pre><code class="Perl" data-trim >use CGI qw(:standard);
print header;
print start_html('Form Example'),
    h1('My Example Form'),
    start_form,
    &quot;Name: &quot;, textfield('name'),
    p,
    &quot;Age: &quot;, textfield('age'),
    p,
    submit,
    end_form;
if(param()) {
    print &quot;Hi &quot;,em(param('name')),
        &quot;You are &quot;,em(param('age')),
        &quot; years old&quot;;
}
print end_html;</code></pre>
		</section>	</section>
	<section>
		<section id="hist_1994">
		<h3 class="p" style="text-align:center;">1994-1995</h3>
		<pre><code class="PHP" data-trim >&lt;html&gt;&lt;head&gt;&lt;title&gt;Form Example&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;My Example Form&lt;/h1&gt;
&lt;form action=&quot;form.phtml&quot; method=&quot;POST&quot;&gt;
Name: &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;
Age: &lt;input type=&quot;text&quot; name=&quot;age&quot;&gt;
&lt;br&gt;&lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
&lt;?if($name):?&gt;
Hi &lt;?echo $name?&gt;, you are &lt;?echo $age?&gt; years old
&lt;?endif?&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre>
		</section>	</section>
	<section>
		<h3 class="p">Focus on the Ecosystem</h3>
		<ul>
			<li style="font-size: 1.1em;margin-left: 2em;list-style-type: none;">LAMP wasn't an accident</li>
			<li style="font-size: 1.1em;margin-left: 2em;list-style-type: none;">Robustness, Performance and Security</li>
			<li style="font-size: 1.1em;margin-left: 2em;list-style-type: none;"><font color="ff2233">â™¥</font> shared hosting ISPs</li>
		</ul>
<br/>
		<h3 class="p">Scale</h3>
		<ul>
			<li style="font-size: 1.1em;margin-left: 2em;list-style-type: none;">Scaling up is expected</li>
			<li style="font-size: 1.1em;margin-left: 2em;list-style-type: none;">Scaling down is surprisingly hard</li>
			<li style="font-size: 1.1em;margin-left: 2em;list-style-type: none;">Doing both is rocket science</li>
		</ul>
	</section>
	<section>
		<section id="php72">
		<h1 style="text-align:center;">PHP 7.2</h1>
		</section>
<section id="php72_opt">
		<p class="p" style="font-size:1.6em;text-align:left;">Initial DCE and SCCP optimizations</p>
		</section>
<section id="php72_widening">
		<p class="p" style="font-size:1.1em;text-align:left;">Parameter Type Widening</p>
		<pre><code data-trim style="font-size:1.1em;" >class Orig {
  public function fn(array $arg) {  }
}
class Wider extends Orig {
  public function fn($arg) { }
}</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">In PHP 7.1 you would get:</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1em;" >Warning: Declaration of Wider::fn($arg) should be 
         compatible with Orig::fn(array $arg)</code></pre>
		</section>
<section id="php72_commas">
		<p class="p" style="font-size:1.1em;text-align:left;">Allow trailing commas everywhere</p>
		<pre><code data-trim style="font-size:1em;" >// Arrays (already possible)
$array = [1, 2, 3,];

// Grouped namepaces
use Foo\Bar\{ Foo, Bar, Baz, };
 
// Function/method arguments (call)
fooCall($arg1, $arg2, $arg3,);

use Foo\Bar\{ Foo, Bar, Baz, };

class Foo implements
    // Interface implementations on a class
    FooInterface,
    BarInterface,
    BazInterface,
{
    // Trait implementations on a class
    use
        FooTrait,
        BarTrait,
        BazTrait,
    ;
 
    // Class member lists
    const
        A = 1010,
        B = 1021,
        C = 1032,
        D = 1043,
    ;</code></pre>
		</section>
<section id="php72_object">
		<p class="p" style="font-size:1.1em;text-align:left;">Object typehint</p>
		<pre><code data-trim style="font-size:1.05em;" >function fn(object $obj): object {
	return json_decode('{}');
}
fn(&quot;not an object&quot;);</code></pre>
		<pre><code class="result nohighlight" data-trim style="font-size:0.9em;" >Warning: Uncaught TypeError: Argument 1 passed to fn() must be an object,
         string given, called in php shell code on line 1 and defined in ...</code></pre>
		</section>
<section id="php72_unqouted">
		<p class="p" style="font-size:1.1em;text-align:left;">Deprecate unquoted strings</p>
		<pre><code data-trim style="font-size:1.05em;" >echo HELLO;</code></pre>
		<pre><code class="result nohighlight" data-trim style="font-size:0.9em;" >Warning: Use of undefined constant HELLO - assumed 'HELLO' (this will throw
         an Error in a future version of PHP) in php shell code on line 1</code></pre>
		</section>
<section id="php72_mail">
		<p class="p" style="font-size:1.1em;text-align:left;">extra headers array arg for mail() and mb_send_mail()</p>
		<pre><code data-trim style="font-size:1.05em;" >$to      = 'nobody@example.com';
$subject = 'the subject';
$message = 'hello';
$headers = ['From'     =&gt; 'webmaster@example.com',
            'Reply-To' =&gt; 'webmaster@example.com',
            'X-Mailer' =&gt; 'PHP/' . phpversion() ];

mail($to, $subject, $message, $headers);</code></pre>
		</section>
<section id="php72_argon2i">
		<p class="p" style="font-size:1.1em;text-align:left;">Argon2i added to password_hash()</p>
		<pre><code data-trim style="font-size:1.05em;" >$options = [
    'memory_cost' =&gt; 2048,
    'time_cost' =&gt; 10,
    'threads' =&gt; 2
];
echo password_hash(&quot;rasmuslerdorf&quot;, PASSWORD_ARGON2I, $options);</code></pre>
		<pre><code class="result nohighlight" data-trim style="font-size:0.9em;" >$argon2i$v=19$m=2048,t=10,p=2$akUuWkoxRDlMSi5TVGhYLg$j0D1Cl4aR8UMHOGGx5JtZ1BmCApr8RmOJA9qFWm5mz8</code></pre>
		</section>
<section id="php72_sodium">
		<p class="p" style="font-size:1.1em;text-align:left;">Add Sodium Crypto Library</p>
		<pre><code data-trim style="font-size:1.05em;" >// On Alice's computer:
$msg = 'This comes from Alice.';
$signed_msg = sodium_crypto_sign($msg, $secret_sign_key);</code></pre>
		<pre><code data-trim style="font-size:1.05em;" >// On Bob's computer:
$original_msg = sodium_crypto_sign_open($signed_msg, $alice_sign_publickey);
if ($original_msg === false) {
    throw new Exception(&quot;Invalid signature&quot;);
} else {
    echo $original_msg; // Displays &quot;This comes from Alice.&quot;
}</code></pre>
		<div align="" style="font-size: 1em; color: ; text-align: ; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;">see: <a href="https://paragonie.com/book/pecl-libsodium" target="">https://paragonie.com/book/pecl-libsodium</a></div>
		</section>
<section id="php72cleanups">
		<p class="p" style="font-size:1.1em;text-align:left;">Things that may break your code</p>
		<ul>
			<li style="font-size: 0.8em;margin-left: -1em;">mcrypt extension has been removed</li>
			<li style="font-size: 0.8em;margin-left: -1em;">__autoload() deprecated, use spl_autoload_register()</li>
			<li style="font-size: 0.8em;margin-left: -1em;">create_function() deprecated, use anonymous functions</li>
			<li style="font-size: 0.8em;margin-left: -1em;">each() deprecated, use foreach()</li>
			<li style="font-size: 0.8em;margin-left: -1em;">read_exif_data() deprecated, use exif_read_data()</li>
		</ul>
		<p class="p" style="font-size:1.1em;text-align:left;">Full details are at:</p>
		<div align="" style="font-size: 0.8em; color: ; text-align: ; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/php/php-src/blob/PHP-7.2/UPGRADING" target="">https://github.com/php/php-src/blob/PHP-7.2/UPGRADING</a></div>
		<p class="p" style="font-size:1.1em;text-align:left;">And for extension authors:</p>
		<div align="" style="font-size: 0.8em; color: ; text-align: ; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/php/php-src/blob/PHP-7.2/UPGRADING.INTERNALS" target="">https://github.com/php/php-src/blob/PHP-7.2/UPGRADING.INTERNALS</a></div>
		</section>	</section>
	<section>
		<section id="php73">
		<h1 style="text-align:center;">PHP 7.3</h1>
		</section>
<section id="php73_heredoc">
		<p class="p" style="font-size:1.1em;text-align:left;">Flexible Heredoc</p>
		<pre><code data-trim style="font-size:1.1em;" >class foo {
    public $bar = &lt;&lt;&lt;EOT
    bar
    EOT;
}</code></pre>
		</section>
<section id="php73_continue">
		<p class="p" style="font-size:1.1em;text-align:left;">Continue in Switch</p>
		<pre><code data-trim style="font-size:1.1em;" >while ($foo) {
    switch ($bar) {
        case &quot;baz&quot;:
            continue;
    }
}</code></pre>
		<pre><code class="nohighlight" data-trim style="font-size:1.1em;" >Warning: &quot;continue&quot; targeting switch is equivalent to &quot;break&quot;.
         Did you mean to use &quot;continue 2&quot;?</code></pre>
		</section>
<section id="php73_listrefs">
		<p class="p" style="font-size:1.1em;text-align:left;">List References</p>
		<pre><code data-trim style="font-size:1.1em;" >$array = [1, 2];
list($a, &amp;$b) = $array;
// or
[$a, &amp;$b] = $array;</code></pre>
		</section>
<section id="php73_commas">
		<p class="p" style="font-size:1.1em;text-align:left;">Trailing comma allowed in function calls</p>
		<pre><code data-trim style="font-size:1.1em;" >$newArray = array_merge(
    $arrayOne,
    $arrayTwo,
    ['foo', 'bar'],
);

# Parse error
function bar($a, $b,) { }

# Parse error
foo(,);

# Parse error
foo('function', 'bar',,);

# Also parse error
foo(, 'function', 'bar');</code></pre>
		</section>
<section id="php73_hrtime">
		<p class="p" style="font-size:1.1em;text-align:left;">New Monotonic Timer function</p>
		<pre><code data-trim style="font-size:1.0em;" >php &gt; print_r(hrtime());
Array
(
    [0] =&gt; 2320165    // seconds
    [1] =&gt; 979969517  // nanoseconds
)
php &gt; print_r(hrtime(true));
2320183081647424</code></pre>
		</section>
<section id="php73_fpm_status">
		<p class="p" style="font-size:1.1em;text-align:left;">New fpm_get_status() function</p>
		<pre><code data-trim style="font-size:1.1em;" >print_r(fpm_get_status());
Array (
    [pool] =&gt; www
    [process-manager] =&gt; static
    [start-time] =&gt; 1536934549
    [start-since] =&gt; 26
    [accepted-conn] =&gt; 20039
    [listen-queue] =&gt; 0
    [max-listen-queue] =&gt; 0
    [listen-queue-len] =&gt; 0
    [idle-processes] =&gt; 0
    [active-processes] =&gt; 47
    [total-processes] =&gt; 47
    [max-active-processes] =&gt; 514
    [max-children-reached] =&gt; 0
    [slow-requests] =&gt; 0
    [procs] =&gt; Array (
            [0] =&gt; Array (
                    [pid] =&gt; 10819
                    [state] =&gt; Running
                    [start-time] =&gt; 1536934549
                    [start-since] =&gt; 26
                    [requests] =&gt; 2001
                    [request-duration] =&gt; 8108
                    [request-method] =&gt; GET
                    [request-uri] =&gt; /index.php
                    [query-string] =&gt; p=1
                    [request-length] =&gt; 0
                    [user] =&gt; -
                    [script] =&gt; /var/www/wordpress/index.php
                    [last-request-cpu] =&gt; 0
                    [last-request-memory] =&gt; 0
                )
            ...</code></pre>
		</section>
<section id="php73_iscountable">
		<p class="p" style="font-size:1.1em;text-align:left;">is_countable()</p>
		<pre><code data-trim style="font-size:1.1em;" >if (is_array($foo) || $foo instanceof Countable) {
    // $foo is countable
}

if (is_countable($foo)) {
    // $foo is countable
}</code></pre>
		</section>
<section id="php73_array_key">
		<p class="p" style="font-size:1.1em;text-align:left;">array_key_first()/array_key_last()</p>
		<pre><code data-trim style="font-size:1.1em;" >$a = ['abc'=&gt;'First', 'def'=&gt;'Second', 'ghi'=&gt;'Third'];
echo array_key_first($a);
// abc
echo array_key_last($a);
// ghi</code></pre>
		</section>
<section id="php73_opt">
		<p class="p" style="font-size:1.6em;text-align:left;">More DCE and SCCP optimizations</p>
		</section>
<section id="php73misc">
		<p class="p" style="font-size:1.1em;text-align:left;">Other changes</p>
		<ul>
			<li style="font-size: 0.8em;margin-left: -1em;">Upgraded from PCRE to PCRE2</li>
			<li style="font-size: 0.8em;margin-left: -1em;">getallheaders() now available in php-fpm</li>
			<li style="font-size: 0.8em;margin-left: -1em;">full case-mapping for mbstring</li>
			<li style="font-size: 0.8em;margin-left: -1em;">preg_quote() now also escapes '#'</li>
			<li style="font-size: 0.8em;margin-left: -1em;">new gmp functions: gmp_binomial, gmp_lcm, gmp_perfect_power, gmp_kronecker</li>
			<li style="font-size: 0.8em;margin-left: -1em;">new JsonException</li>
			<li style="font-size: 0.8em;margin-left: -1em;">default ftp transfer mode is now binary</li>
		</ul>
		</section>
<section id="php73cleanups">
		<p class="p" style="font-size:1.1em;text-align:left;">Things that may break your code</p>
		<ul>
			<li style="font-size: 0.8em;margin-left: -1em;">PCRE2 differences (should be rare)</li>
			<li style="font-size: 0.8em;margin-left: -1em;">ODBCRouter and Birdstep support have been removed</li>
			<li style="font-size: 0.8em;margin-left: -1em;">Various deprecations - see UPGRADING</li>
		</ul>
		<p class="p" style="font-size:1.1em;text-align:left;">Full details are at:</p>
		<div align="" style="font-size: 0.8em; color: ; text-align: ; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/php/php-src/blob/PHP-7.3/UPGRADING" target="">https://github.com/php/php-src/blob/PHP-7.3/UPGRADING</a></div>
		<p class="p" style="font-size:1.1em;text-align:left;">And for extension authors:</p>
		<div align="" style="font-size: 0.8em; color: ; text-align: ; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/php/php-src/blob/PHP-7.3/UPGRADING.INTERNALS" target="">https://github.com/php/php-src/blob/PHP-7.3/UPGRADING.INTERNALS</a></div>
		</section>	</section>
	<section>
		<section id="wpbench">

<div id="wpbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/wp2018.js"></script>
		</section>	</section>
	<section>
		<section id="smemwp">

<div id="smemwp_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/smemwp2018.js"></script>
		</section>	</section>
	<section>
		<section id="supported">
		<h2 style="text-align:center;">Version Support</h2>
		<img src="http://php.net/images/supported-versions.php" align="center" width="" height="">
<font size="6em">
<table align="left" width="60%" border="0" style="margin-left: 1em;"><tr>
 <td bgcolor="#90C090"><span style="font-size: 1em;">Active Support</span>
 </td> <td ><span style="">Regular releases and security fixes</span>
 </td></tr>
<tr>
 <td bgcolor="#F09030"><span style="font-size: 1em;">Security Fixes</span>
 </td> <td ><span style="">Only security fixes</span>
 </td></tr>
<tr>
 <td bgcolor="F03030"><span style="font-size: 1em;">End of Life</span>
 </td> <td ><span style="">No longer supported</span>
 </td></tr>
</table></font><br />
		</section>	</section>
	<section>
		<section id="impact">
		<h1 style="text-align:center;">Saving the Planet?</h1>
		</section>
<section id="impact1">
		<ul>
			<li style="font-size: 1.5em;margin-left: -1em;">Around 2 billion sites on the web</li>
			<li style="font-size: 1.5em;margin-left: -1em;">On 10 million physical machines</li>
			<li style="font-size: 1.5em;margin-left: -1em;">PHP drives at least 50%</li>
		</ul>
		</section>
<section id="impact2">
		<ul>
			<li style="font-size: 1.5em;margin-left: -1em;">Currently ~50% PHP 7 Adoption</li>
			<li style="font-size: 1.5em;margin-left: -1em;">which is about 2.5M physical servers</li>
		</ul>
		</section>
<section id="impact3">
		<ul>
			<li style="font-size: 1.5em;margin-left: -1em;">3000 KWH/year per server costs approx. US$400</li>
			<li style="font-size: 1.5em;margin-left: -1em;">Data center cooling doubles that</li>
			<li style="font-size: 1.5em;margin-left: -1em;">0.5kg CO2 per KWH</li>
		</ul>
		</section>
<section id="impact4">
		<p class="p" style="font-size:2em;text-align:left;">At 50% Adoption</p>
		<ul>
			<li style="font-size: 1.5em;margin-left: -1em;">US $2B savings</li>
			<li style="font-size: 1.5em;margin-left: -1em;">7.5B KWH Savings</li>
			<li style="font-size: 1.5em;margin-left: -1em;">3.75B kg less CO2</li>
		</ul>
		</section>
<section id="impact5">
		<p class="p" style="font-size:2em;text-align:left;">Let's double that to 100%!</p>
		<ul>
			<li style="font-size: 1.5em;margin-left: -1em;">$4B savings</li>
			<li style="font-size: 1.5em;margin-left: -1em;">15B KWH Savings</li>
			<li style="font-size: 1.5em;margin-left: -1em;">7.5B kg less CO2</li>
		</ul>
		</section>
<section id="impact6">
		<h1 style="text-align:center;">Do your part</h1>
		<h1 style="text-align:center;">Upgrade to PHP 7!</h1>
		</section>	</section>
	<section>
		<section id="dce">
		<p class="p" style="font-size:2em;text-align:center;">Dead Code Elimination (DCE)</p>
		<p class="p" style="font-size:1.5em;text-align:center;">Escape Analysis</p>
		<p class="p" style="font-size:1.4em;text-align:center;">Sparse Conditional Constant Propagation</p>
		</section>
<section id="dce0">
		<pre><code class="result nohighlight" data-trim style="font-size:0.9em;" >php -d opcache.optimization_level=-1 -d opcache.opt_debug_level=0x20000 script</code></pre>
		<pre><code data-trim style="font-size:1.05em;" >function fn() {
    $a = 1;
    return 0;
}</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">PHP 7.1</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1em;" >fn: (lines=2, args=0, vars=1, tmps=0)
L0:   ASSIGN CV0($a) int(1)
L1:   RETURN int(0)</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">PHP 7.2/7.3</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1em;" >fn: (lines=1, args=0, vars=0, tmps=0)
L0:   RETURN int(0)</code></pre>
		</section>
<section id="dce1">
		<pre><code data-trim style="font-size:1.05em;" >function foo(string $s1, string $s2, string $s3, string $s4) {
    $x = ($s1 . $s2) . ($s3 . $s4);
    $x = 0;
    return $x;
}</code></pre>
		<pre><code class="result nohighlight" data-trim style="font-size:1em;" >PHP 7.1                                   PHP 7.2/7.3
foo: (lines=10, args=4, vars=5, tmps=3)   foo: (lines=5, args=4, vars=4, tmps=0)
L0:   CV0($s1) = RECV 1                   L0:   CV0($s1) = RECV 1
L1:   CV1($s2) = RECV 2                   L1:   CV1($s2) = RECV 2
L2:   CV2($s3) = RECV 3                   L2:   CV2($s3) = RECV 3
L3:   CV3($s4) = RECV 4                   L3:   CV3($s4) = RECV 4
L4:   T6 = CONCAT CV0($s1) CV1($s2)       L4:   RETURN int(0)
L5:   T7 = CONCAT CV2($s3) CV3($s4)
L6:   T5 = CONCAT T6 T7
L7:   ASSIGN CV4($x) T5
L8:   ASSIGN CV4($x) int(0)
L9:   RETURN CV4($x)</code></pre>
		</section>
<section id="dce2">
		<p class="p" style="font-size:1.1em;text-align:left;">Try to trick it</p>
		<pre><code data-trim style="font-size:1.05em;" >function foo($a) {
    $b = $a += 3;
    return $a;
}</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">PHP 7.2/7.3</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1em;" >foo: (lines=3, args=1, vars=1, tmps=1)
L0:   CV0($a) = RECV 1
L1:   ASSIGN_ADD CV0($a) int(3)
L2:   RETURN CV0($a)</code></pre>
		</section>
<section id="dce3">
		<p class="p" style="font-size:1.1em;text-align:left;">But...</p>
		<pre><code data-trim style="font-size:1.05em;" >function foo(int $x, int $y) {
    $a = [$x];
    $a[1] = $y;
    $a = $y;
    return $a;
}</code></pre>
		<pre><code class="result nohighlight" data-trim style="font-size:1em;" >PHP 7.2                                    PHP 7.3
foo: (lines=7, args=2, vars=3, tmps=1)     foo: (lines=4, args=2, vars=3, tmps=0)
L0:   CV0($x) = RECV 1                     L0:     CV0($x) = RECV 1
L1:   CV1($y) = RECV 2                     L1:     CV1($y) = RECV 2
L2:   CV2($a) = INIT_ARRAY 1 CV0($x) NEXT  L2:     CV2($a) = QM_ASSIGN CV1($y)
L3:   ASSIGN_DIM CV2($a) int(1)            L3:     RETURN CV2($a)
L4:   OP_DATA CV1($y)
L5:   ASSIGN CV2($a) CV1($y)
L6:   RETURN CV2($a)</code></pre>
		</section>
<section id="dce4">
		<pre><code data-trim style="font-size:1.05em;" >class A { }
function foo(int $x) {
    $a = new A;
    $a-&gt;foo = $x;
    return $x;
}</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">PHP 7.3</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1.05em;" >foo: (lines=2, args=1, vars=1, tmps=0)
L0:   CV0($x) = RECV 1
L1:   RETURN CV0($x)</code></pre>
		</section>
<section id="dce5">
		<pre><code data-trim style="font-size:1.05em;" >class A {
    function __destruct() {}
}
function foo(int $x) {
    $a = new A;
    $a-&gt;foo = $x;
    return $x;
}</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">PHP 7.3</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1.05em;" >foo: (lines=7, args=1, vars=2, tmps=1)
L0:   CV0($x) = RECV 1
L1:   V2 = NEW 0 string(&quot;A&quot;)
L2:   DO_FCALL
L3:   CV1($a) = QM_ASSIGN V2
L4:   ASSIGN_OBJ CV1($a) string(&quot;foo&quot;)
L5:   OP_DATA CV0($x)
L6:   RETURN CV0($x)</code></pre>
		</section>
<section id="dce6">
		<pre><code data-trim style="font-size:1.05em;" >function foo(int $x) {
    if ($x) {
        $a = [0,1];
    } else {
        $a = [0,2];
    }
    return $a[0];
}</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">PHP 7.3</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1.05em;" >foo: (lines=2, args=1, vars=1, tmps=0)
L0:   CV0($x) = RECV 1
L1:   RETURN int(0)</code></pre>
		</section>
<section id="dce7">
		<pre><code data-trim style="font-size:1.05em;" >function foo() {
    $o = new stdClass();
    $o-&gt;foo = 0;
    $i = 1;
    $c = $i &lt; 2;
    if ($c) {
        $k = 2 * $i;
        $o-&gt;foo = $i;
        echo $o-&gt;foo;
    }
    $o-&gt;foo += 2;
    $o-&gt;foo++;
    return $o-&gt;foo;
}</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">PHP 7.3</p>
		<pre><code class="result nohighlight" data-trim style="font-size:1.05em;" >foo: (lines=2, args=0, vars=0, tmps=0)
L0:   ECHO int(1)
L1:   RETURN int(4)</code></pre>
		</section>	</section>
	<section>
		<section id="phan">
		<h1 style="text-align:center;">Static Analysis</h1>
<br/>
<br/>
		<div align="center" style="font-size: 2em; color: ; text-align: center; margin-left: ; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/phan/phan" target="">github.com/phan/phan</a></div>
		</section>
<section id="phan0">
		<p class="p" style="font-size:1.5em;text-align:left;">Install with composer</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1em;" >$ composer require --dev phan/phan</code></pre>
		<p class="p" style="font-size:1.5em;text-align:left;">Create .phan/config.php</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1em;" >return [
    'target_php_version' =&gt; '7.2',
    'directory_list' =&gt; [ 'src/' ],
    &quot;exclude_analysis_directory_list&quot; =&gt; [ 'vendor/' ],
];</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:1em;" >$ ./vendor/bin/phan</code></pre>
		</section>
<section id="phan1">
		<p class="p" style="font-size:2em;text-align:left;">Checks</p>
		<ul>
			<li>enhanced phpdoc type annotations</li>
			<li>Everything is defined and accessible</li>
			<li>Type safety</li>
			<li>PHP version compatibility</li>
			<li>No-ops</li>
			<li>Unreachable code</li>
			<li>Unused use statements</li>
			<li>Redefinitions</li>
			<li>Signature compatibility and final on inheritance</li>
			<li>and many more</li>
		</ul>
		</section>
<section id="phan2">
		<p class="p" style="font-size:1em;text-align:left;">Enhanced PHPDoc type annotations</p>
		<pre><code data-trim style="font-size:1em;" >class C {
  /**
   * @param string|int $union
   * @param int[] $generic
   * @param array{mode:string,max:int} $shaped
   */
  static function fn($union, array $generic, $shaped) { }
}
C::fn(&quot;test&quot;, [1,2,3], ['mode'=&gt;&quot;test&quot;, 'max'=&gt;10]);
C::fn(1, [1,2,3], ['mode'=&gt;&quot;test&quot;, 'max'=&gt;10]);
C::fn(&quot;test&quot;, [1,2,3], ['max'=&gt;10,'mode'=&gt;&quot;test&quot;]);

C::fn([1], [1,2,3], ['mode'=&gt;&quot;test&quot;, 'max'=&gt;10]);
// PhanTypeMismatchArgument Argument 1 (union) is array{0:1}
// but \C::fn() takes int|string

C::fn(&quot;test&quot;, [1,2,3], ['max'=&gt;10]);
// PhanTypeMismatchArgument Argument 3 (shaped) is array{max:10}
// but \C::fn() takes array{mode:string,max:int}</code></pre>
		</section>
<section id="phan3">
		<p class="p" style="font-size:1.5em;text-align:left;">User plugins</p>
		<div align="center" style="font-size: 1.5em; color: ; text-align: center; margin-left: ; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/phan/phan/wiki/Writing-Plugins-for-Phan" target="">Writing Plugins for Phan</a></div>
		<p class="p" style="font-size:1.5em;text-align:left;">Included sample plugins</p>
		<ul style="column-count:2;column-gap:1.8em;font-size:0.8em">
			<li>Demo Plugin</li>
			<li>Preg Regex Checker</li>
			<li>Printf Checker</li>
			<li>Unreachable Code</li>
			<li>DollarDollar</li>
			<li>NonBool Branch</li>
			<li>Numerical Comparison</li>
			<li>Has PHPDoc</li>
			<li>Duplicate Expression</li>
		</ul>
		</section>
<section id="phan4">
		<p class="p" style="font-size:2em;text-align:left;">Daemon mode</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1em;" >$ phan --daemonize-tcp-port default &amp;
[1] 28610
Listening for Phan analysis requests at tcp://127.0.0.1:4846
Awaiting analysis requests for directory '/home/rasmus/phan_demo'

$ vi src/script.php</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:1em;" >$ phan_client -l src/script.php
Phan error: TypeError: PhanTypeMismatchArgument: Argument 1 (union) is array{0:1} but \C::fn() takes int|string defined at src/script.php:8 in src/script.php on line 14
Phan error: TypeError: PhanTypeMismatchArgument: Argument 3 (shaped) is array{max:10} but \C::fn() takes array{mode:string,max:int} defined at src/script.php:8 in src/script.php on line 16</code></pre>
		</section>
<section id="phan5">
		<p class="p" style="font-size:1.5em;text-align:left;">vim integration</p>
	<div id="container">
      <video id='video' controls="controls" preload='none' onclick='this.paused ? this.play() : this.pause();'
        width="1848"  >
        <source id='mp4' src="presentations/slides/intro/phanvid.mp4" type='video/mp4'/>
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
    </div>		</section>	</section>
	<section>
		<section id="phpspy">
		<h1 style="text-align:center;">phpspy</h1>
		<p class="p" style="font-size:1.1em;text-align:center;">Low-overhead sampling profiler</p>
		<div align="center" style="font-size: 1em; color: ; text-align: center; margin-left: ; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/adsr/phpspy" target="">https://github.com/adsr/phpspy</a></div>
		</section>
<section id="spy1">
		<p class="p" style="font-size:1.1em;text-align:left;">Sample frequency in nanoseconds (or Hz)</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;" >$ phpspy -s 200000000 -- php -r 'sleep(1);' 
0 sleep &lt;internal&gt;:-1
1 &lt;main&gt; &lt;internal&gt;:-1

0 sleep &lt;internal&gt;:-1
1 &lt;main&gt; &lt;internal&gt;:-1

0 sleep &lt;internal&gt;:-1
1 &lt;main&gt; &lt;internal&gt;:-1

0 sleep &lt;internal&gt;:-1
1 &lt;main&gt; &lt;internal&gt;:-1

0 sleep &lt;internal&gt;:-1
1 &lt;main&gt; &lt;internal&gt;:-1

process_vm_readv: No such process</code></pre>
		</section>
<section id="spy2">
		<p class="p" style="font-size:1.1em;text-align:left;">Attach to a running process</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;" >$ sudo phpspy -r -p $(pgrep -n php-fpm)

0 wp_installing /var/www/wordpress/wp-includes/load.php:944
1 wp_load_alloptions /var/www/wordpress/wp-includes/option.php:189
2 get_option /var/www/wordpress/wp-includes/option.php:90
3 create_initial_taxonomies /var/www/wordpress/wp-includes/taxonomy.php:43
4 WP_Hook::apply_filters /var/www/wordpress/wp-includes/class-wp-hook.php:286
5 WP_Hook::do_action /var/www/wordpress/wp-includes/class-wp-hook.php:310
6 do_action /var/www/wordpress/wp-includes/plugin.php:453
7 &lt;main&gt; /var/www/wordpress/wp-settings.php:450
8 &lt;main&gt; /var/www/wordpress/wp-config.php:89
9 &lt;main&gt; /var/www/wordpress/wp-load.php:37
10 &lt;main&gt; /var/www/wordpress/wp-blog-header.php:13
11 &lt;main&gt; /var/www/wordpress/index.php:17
# 1537119612.459615 /index.php p=1 /var/www/wordpress/index.php -

0 mysqli_query &lt;internal&gt;:-1
1 wpdb::_do_query /var/www/wordpress/wp-includes/wp-db.php:1924
2 wpdb::query /var/www/wordpress/wp-includes/wp-db.php:1813
3 wpdb::get_results /var/www/wordpress/wp-includes/wp-db.php:2488
4 _prime_comment_caches /var/www/wordpress/wp-includes/comment.php:2871
5 WP_Comment_Query::get_comments /var/www/wordpress/wp-includes/class-wp-comment-query.php:427
6 WP_Comment_Query::query /var/www/wordpress/wp-includes/class-wp-comment-query.php:346
7 get_comments /var/www/wordpress/wp-includes/comment.php:226
8 WP_Widget_Recent_Comments::widget /var/www/wordpress/wp-includes/widgets/class-wp-widget-recent-comments.php:99
9 WP_Widget::display_callback /var/www/wordpress/wp-includes/class-wp-widget.php:372
10 dynamic_sidebar /var/www/wordpress/wp-includes/widgets.php:743
11 &lt;main&gt; /var/www/wordpress/wp-content/themes/twentyfifteen/sidebar.php:41
12 load_template /var/www/wordpress/wp-includes/template.php:688
13 locate_template /var/www/wordpress/wp-includes/template.php:647
14 get_sidebar /var/www/wordpress/wp-includes/general-template.php:110
15 &lt;main&gt; /var/www/wordpress/wp-content/themes/twentyfifteen/header.php:49
16 load_template /var/www/wordpress/wp-includes/template.php:688
17 locate_template /var/www/wordpress/wp-includes/template.php:647
18 get_header /var/www/wordpress/wp-includes/general-template.php:41
19 &lt;main&gt; /var/www/wordpress/wp-content/themes/twentyfifteen/single.php:10
20 &lt;main&gt; /var/www/wordpress/wp-includes/template-loader.php:74
21 &lt;main&gt; /var/www/wordpress/wp-blog-header.php:19
22 &lt;main&gt; /var/www/wordpress/index.php:17
# 1537119612.459615 /index.php p=1 /var/www/wordpress/index.php -</code></pre>
		</section>
<section id="spy3">
		<p class="p" style="font-size:1.1em;text-align:left;">Generate a flame graph</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;" >$ phpspy phan &gt; /tmp/output
$ cat /tmp/output | stackcollapse-phpspy.pl | flamegraph.pl &gt; flame.svg</code></pre>
		</section>
<section id="spy4">
		<object data="/presentations/slides/intro/phan.svg" type="image/svg+xml" align="center" width="80%" height="80%">Use a newer browser, please</object>
		</section>	</section>
	<section>
		<section id="php74">
		<h1 style="text-align:center;">PHP 7.4</h1>
		</section>
<section id="php74_typedprop">
		<p class="p" style="font-size:1.1em;text-align:left;">Typed Properties</p>
		<pre><code data-trim style="font-size:1.1em;" >class User {
    public int $id;
    public string $name;
 
    public function __construct(int $id, string $name) {
        $this-&gt;id = $id;
        $this-&gt;name = $name;
    }
}</code></pre>
		</section>
<section id="php74_preload">
		<p class="p" style="font-size:1em;text-align:left;">Without Opcache Preloading</p>
		<pre><code data-trim style="font-size:1.1em;" >class A {
    function __construct() {
        echo &quot;A&quot;;
    }
}</code></pre>
		<pre><code data-trim style="font-size:1em;" >spl_autoload_register('__load');
function __load($c) {
    echo &quot;Autoloader called for $c\n&quot;;
    require &quot;/home/rasmus/&quot;.strtolower($c).&quot;.php&quot;;
}

new A;</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.1em;" >$ php script.php 
Autoloader called for A
A</code></pre>
		</section>
<section id="php74_preload2">
		<p class="p" style="font-size:1em;text-align:left;">With Opcache Preloading</p>
		<pre><code data-trim style="font-size:1em;" >function preload($filename) {
    if (!opcache_compile_file($filename)) {
        trigger_error(&quot;Preloading Failed&quot;, E_USER_ERROR);
    }
}

preload(&quot;/home/rasmus/a.php&quot;);</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.1em;" >$ php -d opcache.preload=preload.php script.php 
A</code></pre>
		</section>	</section>
	<section>
		<section id="thank_you">
		<h2 style="text-align:center;">Thank You</h2>
		<div align="left" style="font-size: 1em; color: ; text-align: left; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href=":-:url:-:" target="">http://talks.php.net/etsy18</a></div>
		<div align="left" style="font-size: 1em; color: ; text-align: left; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/phan/phan" target="">https://github.com/phan/phan</a></div>
		<div align="left" style="font-size: 1em; color: ; text-align: left; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/adsr/phpspy" target="">https://github.com/adsr/phpspy</a></div>
		<div align="left" style="font-size: 1em; color: ; text-align: left; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/php/php-src/blob/PHP-7.3/UPGRADING" target="">https://github.com/php/php-src/blob/PHP-7.3/UPGRADING</a></div>
		<div align="left" style="font-size: 1em; color: ; text-align: left; margin-left: -1em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://bugs.php.net" target="">https://bugs.php.net</a></div>
<br/>
<br/>
<br/>
		<p class="p" style="font-size:1.1em;">Report Bugs</p>
		<p class="p" style="font-size:1.1em;">Useful bug reports, please!</p>
		</section>	</section>
			</div>

		</div>

		<script src="/reveal.js/lib/js/head.min.js"></script>
		<script src="/reveal.js/js/reveal.js"></script>

		<script>

			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				width: 1024,
				height: 768,

				transition: 'slide', // none/fade/slide/convex/concave/zoom
				transitionSpeed: 'fast',

				// Optional reveal.js plugins
				dependencies: [
					{ src: '/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '/highlight.min.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '/reveal.js/plugin/zoom-js/zoom.js', async: true },
					{ src: '/reveal.js/plugin/notes/notes.js', async: true },
					{ src: '/reveal.js/plugin/line-numbers/line-numbers.js' }
				]
			});
			/* This draws the graph on the slide on a slidechanged event */
			Reveal.addEventListener('slidechanged', function(event) {
				var callback = "render_"+event.currentSlide.id;
				if(typeof(window[callback])=="function") {
					window[callback]();
				}
			} );
			/* This draws the graph if we got here directly without coming from another slide */
			Reveal.addEventListener('ready', function(event) {
				var callback = "render_"+event.currentSlide.id;
				if(typeof(window[callback])=="function") {
					window[callback]();
				}
			} );
		</script>

	</body>
</html>
